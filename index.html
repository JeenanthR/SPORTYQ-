<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SportyQ</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; width:100%; font-family:"Poppins", sans-serif; background:#0f172a; color:#fff; overflow:hidden; }
body { background:url("Sports.jpg") no-repeat center center fixed; background-size:cover; }

header { width:100%; padding:10px 20px; display:flex; align-items:center; justify-content:space-between; position:absolute; top:0; z-index:10; background: transparent; }
.logo { display:flex; align-items:center; gap:10px; }
.logo img { width:110px; height:auto; }
.logo h1 { font-size:2.2rem; text-shadow:2px 2px 4px rgba(0,0,0,0.8); }
.auth-buttons { display:flex; gap:12px; }
.auth-buttons a { text-decoration:none; padding:8px 20px; border-radius:8px; font-weight:bold; font-size:0.95rem; background:#1e90ff; color:#fff; border:2px solid #1e90ff; cursor:pointer; transition:0.3s; }
.auth-buttons a:hover { background:#fff; color:#1e90ff; }

.section { width:100%; height:100vh; display:none; flex-direction:column; justify-content:center; align-items:center; padding-top:80px; }
.section.active { display:flex; animation: fadeIn 0.5s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.welcome .content { display:flex; width:100%; height:calc(100% - 80px); justify-content:space-around; align-items:center; padding:20px; }
.intro { width:45%; height:90%; padding:25px; background: rgba(0,0,0,0.6); border-radius:12px; overflow-y:auto; }
.intro h2 { font-size:3rem; margin-bottom:15px; }
.intro p { font-size:1.3rem; line-height:1.6; }
.benefits { margin-top:20px; font-size:1.2rem; line-height:1.6; }
.image-side { width:50%; height:90%; border-radius:18px; overflow:hidden; position:relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); background: #000; }
.slide { position:absolute; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity 1s ease-in-out; }
.slide.active { opacity:1; }

.sports-selection { background: rgba(0,0,0,0.4); padding:20px; }
.sports-selection h2 { margin-bottom:30px; font-size:2.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
.sports-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:25px; width:90%; max-width: 1200px; }
.card { background: rgba(20, 20, 30, 0.85); border-radius:15px; overflow:hidden; display:flex; flex-direction:column; align-items:center; justify-content:space-between; transition: transform 0.3s; border: 1px solid rgba(255,255,255,0.1); }
.card:hover { transform: translateY(-5px); border-color: #1e90ff; }
.card img { width:100%; height:160px; object-fit:cover; border-bottom:2px solid #1e90ff; background: #333; }
.card h3 { margin:15px 0; font-size: 1.5rem; }
.card button { margin-bottom:20px; padding:10px 25px; border:none; border-radius:8px; background:#1e90ff; color:#fff; cursor:pointer; font-weight:bold; transition: 0.2s; }
.card button:hover { background: #0077ea; }

.quiz-container { background: rgba(15, 23, 42, 0.95); width: 90%; max-width: 800px; padding: 30px; border-radius: 20px; box-shadow: 0 0 20px rgba(30, 144, 255, 0.3); text-align: center; border: 1px solid rgba(30, 144, 255, 0.3); position: relative; overflow: hidden; }
.quiz-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 1.2rem; color: #88ccff; }
.question-box { margin: 30px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; }
.question-text { font-size: 1.8rem; font-weight: bold; }
.options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
.option-btn { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; color: white; font-size: 1.1rem; cursor: pointer; transition: all 0.2s; }
.option-btn:hover { background: rgba(30, 144, 255, 0.2); border-color: #1e90ff; }
.option-btn.correct { background: #22c55e !important; border-color: #22c55e !important; }
.option-btn.wrong { background: #ef4444 !important; border-color: #ef4444 !important; opacity: 0.6; }
.controls { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
.game-btn { padding: 10px 20px; background: #1e90ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
.game-btn.secondary { background: #475569; }

.admin-panel { background: rgba(0,0,0,0.4); padding:20px; width: 100%; height: 100%; overflow-y: auto; }
.admin-panel h2 { margin-bottom:30px; font-size:2.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); text-align: center; }
.admin-controls { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap; }
.admin-btn { padding: 12px 25px; background: #1e90ff; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
.admin-btn:hover { background: #0077ea; }
.admin-btn.secondary { background: #475569; }
.admin-btn.danger { background: #ef4444; }
.admin-btn.success { background: #22c55e; }
.question-management { background: rgba(20, 20, 30, 0.85); padding: 25px; border-radius: 15px; margin: 20px auto; max-width: 1000px; }
.question-form { display: grid; gap: 15px; margin-bottom: 30px; }
.form-group { display: flex; flex-direction: column; gap: 8px; }
.form-group label { font-weight: bold; color: #94a3b8; }
.form-group input, .form-group select, .form-group textarea { padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #1e90ff; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.questions-list { margin-top: 30px; }
.question-item { background: rgba(15, 23, 42, 0.9); padding: 20px; margin: 15px 0; border-radius: 10px; border: 1px solid #334155; transition: all 0.3s; }
.question-item:hover { border-color: #1e90ff; }
.question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.question-sport { background: #1e90ff; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
.question-actions { display: flex; gap: 10px; }
.question-text { font-size: 1.1rem; margin-bottom: 10px; font-weight: bold; }
.question-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
.option-item { padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; }
.option-item.correct { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }

.celebration-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; display: none; }
.confetti { position: absolute; width: 10px; height: 20px; background: #f00; top: 0; opacity: 0; }
.firework { position: absolute; width: 5px; height: 5px; border-radius: 50%; box-shadow: 0 0 10px #fff; top: 50%; left: 50%; opacity: 0; }
.emoji-celebration { position: absolute; font-size: 2rem; opacity: 0; animation: floatUp 2s forwards; }
@keyframes floatUp { 0% { transform: translateY(0) scale(0.5); opacity: 1; } 100% { transform: translateY(-100px) scale(1); opacity: 0; } }
.score-popup { position: absolute; font-size: 2.5rem; font-weight: bold; color: gold; text-shadow: 0 0 10px rgba(255,215,0,0.8); opacity: 0; animation: popInOut 1.5s forwards; z-index: 1001; }
@keyframes popInOut { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 0; } }
.pulse-effect { animation: pulse 0.5s ease-in-out; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

.modal { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:100; backdrop-filter: blur(5px); }
.modal.active { display:flex; animation: popIn 0.3s ease; }
@keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-content { background:#1e293b; padding:30px; border-radius:16px; width:90%; max-width:400px; color:#fff; border: 1px solid #334155; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
.modal-content h2 { margin-top:0; border-bottom: 1px solid #334155; padding-bottom: 10px; margin-bottom: 20px; }
.modal-content label { display:block; margin-top:15px; font-weight:bold; color: #94a3b8; font-size: 0.9rem; }
.modal-content input { width:100%; padding:12px; margin-top:5px; border-radius:6px; border:1px solid #334155; background: #0f172a; color: white; outline: none; }
.modal-content input:focus { border-color: #1e90ff; }
.modal-content button { margin-top:25px; padding:12px; width:100%; border:none; border-radius:8px; background:#1e90ff; color:#fff; font-weight:bold; cursor:pointer; font-size: 1rem; transition: 0.2s; }
.modal-content button:hover { background: #3b82f6; }
.close-btn { float:right; font-size:1.5rem; cursor:pointer; color: #94a3b8; }
.close-btn:hover { color: white; }

.type-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; padding: 20px; margin-top: 15px; background: #334155; border: 2px solid transparent; border-radius: 12px; color: white; cursor: pointer; transition: 0.3s; }
.type-btn:hover { background: #475569; border-color: #1e90ff; }
.type-btn strong { font-size: 1.1rem; display: block; margin-bottom: 5px; }
.type-btn small { color: #94a3b8; font-weight: normal; }

.error-message { color: #ef4444; font-size: 0.9rem; margin-top: 10px; text-align: center; display: none; }
.success-message { color: #22c55e; font-size: 0.9rem; margin-top: 10px; text-align: center; display: none; }

footer { position:absolute; bottom:0; width:100%; text-align:center; padding:15px 0; background: rgba(0,0,0,0.5); font-size: 1rem; color: #94a3b8; }

@media(max-width:900px){
  .welcome .content { flex-direction:column; justify-content: center; gap: 20px; }
  .intro,.image-side { width:90%; height:auto; min-height: 40%; }
  .options-grid { grid-template-columns: 1fr; }
  .form-row { grid-template-columns: 1fr; }
  .question-options { grid-template-columns: 1fr; }
  .question-header { flex-direction: column; align-items: flex-start; gap: 10px; }
}
</style>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="celebration-container" id="celebrationContainer"></div>

<header>
  <div class="logo">
    <img src="logo1.png" alt="Logo"><h1>SportyQ</h1>
  </div>
  <div class="auth-buttons" id="auth-btns">
    <a class="signin-btn">Sign In</a>
    <a class="signup-btn">Sign Up</a>
    <a class="admin-signin-btn" style="background: #ef4444;">Admin</a>
  </div>
  <div class="auth-buttons" id="user-display" style="display:none;">
    <span style="align-self:center; margin-right:10px; font-weight:bold;">Hi, <span id="username-span">User</span></span>
    <a onclick="logout()">Logout</a>
  </div>
  <div class="auth-buttons" id="admin-display" style="display:none;">
    <span style="align-self:center; margin-right:10px; font-weight:bold; color: #ef4444;">Admin Panel</span>
    <a onclick="openAdminPanel()" style="background: #ef4444;">Manage Questions</a>
    <a onclick="logout()">Logout</a>
  </div>
</header>

<div class="section welcome active">
  <div class="content">
    <div class="intro">
      <h2>Welcome to SportyQ</h2>
      <p>SportyQ is your AI-powered sports trivia companion ‚Äî designed to make learning, competing, and improving your sports knowledge fun and engaging.</p>
      <div class="benefits">
        ‚úî Smart AI-generated sports questions<br>
        ‚úî Covers Football, Cricket, NBA, Tennis and more<br>
        ‚úî Instant answers & explanations<br>
        ‚úî Fun, interactive and gamified experience<br>
        ‚úî Track your scores and improve daily<br>
        ‚úî Admin panel for question management
      </div>
    </div>
    <div class="image-side">
      <img src="sl1.jpg" class="slide active" alt="Slide 1">
      <img src="sl2.jpg" class="slide" alt="Slide 2">
      <img src="sl3.jpg" class="slide" alt="Slide 3">
      <img src="sl4.jpg" class="slide" alt="Slide 4">
      <img src="sl5.jpg" class="slide" alt="Slide 5">
      <img src="sl6.jpg" class="slide" alt="Slide 6">
      <img src="sl7.jpg" class="slide" alt="Slide 7">
      <img src="sl8.jpg" class="slide" alt="Slide 8">
      <img src="sl9.jpg" class="slide" alt="Slide 9">
      <img src="sl10.png" class="slide" alt="Slide 10">
    </div>
  </div>
</div>

<div class="section sports-selection">
  <h2>Select Your Arena</h2>
  <div class="sports-grid">
    <div class="card">
      <img src="football.png" alt="Football">
      <h3>‚öΩ Football</h3>
      <button onclick="chooseQuestionType('Football')">Explore</button>
    </div>
    <div class="card">
      <img src="cricket1.jpg" alt="Cricket">
      <h3>üèè Cricket</h3>
      <button onclick="chooseQuestionType('Cricket')">Explore</button>
    </div>
    <div class="card">
      <img src="NBA1.png" alt="NBA">
      <h3>üèÄ NBA</h3>
      <button onclick="chooseQuestionType('NBA')">Explore</button>
    </div>
    <div class="card">
      <img src="Tennis.jpg" alt="Tennis">
      <h3>üéæ Tennis</h3>
      <button onclick="chooseQuestionType('Tennis')">Explore</button>
    </div>
  </div>
</div>

<div class="section quiz-section" id="quizInterface">
    <div class="quiz-container">
        <div class="quiz-header">
            <span id="quiz-sport-label">Football</span>
            <span>Score: <span id="score-val">0</span></span>
        </div>
        <div class="question-box">
            <div class="question-text" id="question-text">Loading...</div>
        </div>
        <div class="options-grid" id="options-container"></div>
        <div class="controls">
            <button class="game-btn secondary" onclick="exitToMenu()">Exit</button>
            <button class="game-btn" id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question</button>
        </div>
    </div>
</div>

<div class="section admin-panel">
    <h2>Admin Panel - Question Management</h2>
    <div class="admin-controls">
        <button class="admin-btn" onclick="showAddQuestionForm()">
            <i class="fas fa-plus"></i> Add New Question
        </button>
        <button class="admin-btn secondary" onclick="refreshQuestions()">
            <i class="fas fa-sync"></i> Refresh List
        </button>
        <button class="admin-btn" onclick="switchSection('sports-selection')">
            <i class="fas fa-arrow-left"></i> Back to Sports
        </button>
    </div>
    <div class="question-management">
        <div id="question-form-container" style="display: none;">
            <h3 id="form-title">Add New Question</h3>
            <div class="question-form">
                <div class="form-group">
                    <label for="question-sport">Sport:</label>
                    <select id="question-sport">
                        <option value="Football">Football</option>
                        <option value="Cricket">Cricket</option>
                        <option value="NBA">NBA</option>
                        <option value="Tennis">Tennis</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="question-text-input">Question Text:</label>
                    <textarea id="question-text-input" rows="3" placeholder="Enter the question..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="option1">Option 1:</label>
                        <input type="text" id="option1" placeholder="Option 1">
                    </div>
                    <div class="form-group">
                        <label for="option2">Option 2:</label>
                        <input type="text" id="option2" placeholder="Option 2">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="option3">Option 3:</label>
                        <input type="text" id="option3" placeholder="Option 3">
                    </div>
                    <div class="form-group">
                        <label for="option4">Option 4:</label>
                        <input type="text" id="option4" placeholder="Option 4">
                    </div>
                </div>
                <div class="form-group">
                    <label for="correct-answer">Correct Answer:</label>
                    <select id="correct-answer">
                        <option value="0">Option 1</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                        <option value="3">Option 4</option>
                    </select>
                </div>
                <div class="admin-controls">
                    <button class="admin-btn success" onclick="saveQuestion()">
                        <i class="fas fa-save"></i> Save Question
                    </button>
                    <button class="admin-btn secondary" onclick="cancelEdit()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
        <div class="questions-list" id="questions-list">
            <h3>Existing Questions</h3>
            <div id="questions-container"></div>
        </div>
    </div>
</div>

<div class="modal" id="signinModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('signinModal')">&times;</span>
    <h2>Sign In</h2>
    <label>Email</label>
    <input type="email" id="signin-email" placeholder="Enter your email">
    <label>Password</label>
    <input type="password" id="signin-password" placeholder="Enter your password">
    <div id="signin-error" class="error-message"></div>
    <button onclick="signIn()">Sign In</button>
    <p style="margin-top:15px; text-align:center; font-size:0.9rem;">
      Don't have an account? <a href="#" style="color:#1e90ff;" onclick="openSignupFromSignin()">Sign Up</a>
    </p>
  </div>
</div>

<div class="modal" id="signupModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('signupModal')">&times;</span>
    <h2>Sign Up</h2>
    <label>Name</label>
    <input type="text" id="signup-name" placeholder="Your Name">
    <label>Email</label>
    <input type="email" id="signup-email" placeholder="Enter your email">
    <label>Password</label>
    <input type="password" id="signup-password" placeholder="Create a password">
    <div id="signup-error" class="error-message"></div>
    <div id="signup-success" class="success-message"></div>
    <button onclick="signUp()">Create Account</button>
    <p style="margin-top:15px; text-align:center; font-size:0.9rem;">
      Already have an account? <a href="#" style="color:#1e90ff;" onclick="openSigninFromSignup()">Sign In</a>
    </p>
  </div>
</div>

<div class="modal" id="adminSigninModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('adminSigninModal')">&times;</span>
    <h2>Admin Sign In</h2>
    <label>Admin Password</label>
    <input type="password" id="admin-password" placeholder="Enter admin password">
    <div id="admin-error" class="error-message"></div>
    <button onclick="adminSignIn()">Sign In as Admin</button>
  </div>
</div>

<div class="modal" id="questionTypeModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('questionTypeModal')">&times;</span>
    <h2 id="sportName">Select Mode</h2>
    <button class="type-btn" onclick="startQuiz('AI')">
        <strong><i class="fas fa-brain"></i> AI Questions </strong>
    </button>
    <button class="type-btn" onclick="startQuiz('Default')">
        <strong><i class="fas fa-list"></i> Manual Questions </strong>
    </button>
  </div>
</div>

<footer>¬© 2025 SportyQ | Group 11 </footer>

<script>
// ==================== ADMIN CONFIG ====================
const ADMIN_CONFIG = { password: "admin123" };

// ==================== DATA STORAGE ====================
const userDatabase = JSON.parse(localStorage.getItem('sportyq_users')) || {};
let allQuestions = JSON.parse(localStorage.getItem('sportyq_custom_questions')) || {};

// ==================== DEFAULT QUESTIONS ====================
const defaultQuestions = {
    Football: [
        { q: "Who won the 2018 FIFA World Cup?", correct: "France", options: ["France", "Croatia", "Brazil", "Germany"] },
        { q: "Who has won the most Ballon d'Or awards?", correct: "Messi", options: ["Ronaldo", "Messi", "Pele", "Maradona"] },
        { q: "Which club plays at Anfield?", correct: "Liverpool", options: ["Man Utd", "Liverpool", "Chelsea", "Arsenal"] }
    ],
    Cricket: [
        { q: "How many balls are there in a standard over?", correct: "6", options: ["5", "6", "8", "10"] },
        { q: "Who won the 2011 ICC Cricket World Cup?", correct: "India", options: ["Sri Lanka", "India", "Australia", "England"] },
        { q: "Who is known as the 'Little Master'?", correct: "Tendulkar", options: ["Gavaskar", "Kohli", "Tendulkar", "Ponting"] }
    ],
    NBA: [
        { q: "Who is the silhouette on the NBA logo?", correct: "Jerry West", options: ["Michael Jordan", "Kobe Bryant", "Jerry West", "LeBron James"] },
        { q: "Who has scored the most points in NBA history?", correct: "LeBron James", options: ["Kareem Abdul-Jabbar", "LeBron James", "Karl Malone", "Kobe Bryant"] },
        { q: "How many championships did the Chicago Bulls win in the 1990s?", correct: "6", options: ["4", "5", "6", "7"] }
    ],
    Tennis: [
        { q: "Where is Wimbledon played?", correct: "London", options: ["Paris", "London", "New York", "Melbourne"] },
        { q: "Who has won the most Grand Slam titles (Men)?", correct: "Djokovic", options: ["Nadal", "Federer", "Djokovic", "Sampras"] },
        { q: "Who is known as the 'King of Clay'?", correct: "Nadal", options: ["Djokovic", "Federer", "Nadal", "Borg"] }
    ]
};

// ==================== QUESTION MANAGEMENT ====================
let currentEditingId = null;

function initializeQuestions() {
    console.log("Initializing questions...");
    if (Object.keys(allQuestions).length === 0) {
        console.log("No questions found, loading defaults");
        allQuestions = JSON.parse(JSON.stringify(defaultQuestions));
        saveQuestionsToStorage();
    } else {
        console.log("Found existing questions:", allQuestions);
    }
}

function saveQuestionsToStorage() {
    localStorage.setItem('sportyq_custom_questions', JSON.stringify(allQuestions));
    console.log("Questions saved to storage");
}

function showAddQuestionForm() {
    console.log("Showing add question form");
    document.getElementById('question-form-container').style.display = 'block';
    document.getElementById('form-title').textContent = 'Add New Question';
    currentEditingId = null;
    clearQuestionForm();
}

function clearQuestionForm() {
    document.getElementById('question-sport').value = 'Football';
    document.getElementById('question-text-input').value = '';
    document.getElementById('option1').value = '';
    document.getElementById('option2').value = '';
    document.getElementById('option3').value = '';
    document.getElementById('option4').value = '';
    document.getElementById('correct-answer').value = '0';
}

function saveQuestion() {
    console.log("Saving question...");
    
    const sport = document.getElementById('question-sport').value;
    const questionText = document.getElementById('question-text-input').value.trim();
    const option1 = document.getElementById('option1').value.trim();
    const option2 = document.getElementById('option2').value.trim();
    const option3 = document.getElementById('option3').value.trim();
    const option4 = document.getElementById('option4').value.trim();
    const correctIndex = parseInt(document.getElementById('correct-answer').value);
    
    console.log("Form data:", { sport, questionText, option1, option2, option3, option4, correctIndex });
    
    if (!questionText || !option1 || !option2 || !option3 || !option4) {
        alert('Please fill in all fields');
        return;
    }
    
    const options = [option1, option2, option3, option4];
    const correctAnswer = options[correctIndex];
    
    const questionData = { 
        q: questionText, 
        correct: correctAnswer, 
        options: options 
    };
    
    console.log("Question data to save:", questionData);
    
    if (currentEditingId !== null) {
        console.log("Updating existing question at index:", currentEditingId);
        allQuestions[sport][currentEditingId] = questionData;
    } else {
        console.log("Adding new question");
        if (!allQuestions[sport]) {
            allQuestions[sport] = [];
        }
        allQuestions[sport].push(questionData);
    }
    
    saveQuestionsToStorage();
    loadAllQuestions();
    cancelEdit();
    alert('Question saved successfully!');
}

function loadAllQuestions() {
    console.log("Loading all questions...");
    const container = document.getElementById('questions-container');
    container.innerHTML = '';
    
    let hasQuestions = false;
    for (const sport in allQuestions) {
        if (allQuestions[sport] && allQuestions[sport].length > 0) {
            hasQuestions = true;
            console.log(`Loading ${allQuestions[sport].length} questions for ${sport}`);
            allQuestions[sport].forEach((question, index) => {
                const questionElement = createQuestionElement(sport, question, index);
                container.appendChild(questionElement);
            });
        }
    }
    
    if (!hasQuestions) {
        console.log("No questions found to display");
        container.innerHTML = '<p style="text-align: center; color: #94a3b8;">No questions found. Add some questions to get started!</p>';
    }
}

function createQuestionElement(sport, question, index) {
    const div = document.createElement('div');
    div.className = 'question-item';
    div.innerHTML = `
        <div class="question-header">
            <span class="question-sport">${sport}</span>
            <div class="question-actions">
                <button class="admin-btn" onclick="editQuestion('${sport}', ${index})">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="admin-btn danger" onclick="deleteQuestion('${sport}', ${index})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
        <div class="question-text">${question.q}</div>
        <div class="question-options">
            ${question.options.map((opt, optIndex) => `
                <div class="option-item ${opt === question.correct ? 'correct' : ''}">
                    ${String.fromCharCode(65 + optIndex)}. ${opt}
                    ${opt === question.correct ? ' ‚úì' : ''}
                </div>
            `).join('')}
        </div>
    `;
    return div;
}

function editQuestion(sport, index) {
    console.log(`Editing question: ${sport} at index ${index}`);
    const question = allQuestions[sport][index];
    document.getElementById('question-form-container').style.display = 'block';
    document.getElementById('form-title').textContent = 'Edit Question';
    
    document.getElementById('question-sport').value = sport;
    document.getElementById('question-text-input').value = question.q;
    document.getElementById('option1').value = question.options[0];
    document.getElementById('option2').value = question.options[1];
    document.getElementById('option3').value = question.options[2];
    document.getElementById('option4').value = question.options[3];
    
    const correctIndex = question.options.indexOf(question.correct);
    document.getElementById('correct-answer').value = correctIndex.toString();
    
    currentEditingId = index;
    console.log("Edit form populated, currentEditingId:", currentEditingId);
}

function deleteQuestion(sport, index) {
    console.log(`Deleting question: ${sport} at index ${index}`);
    if (confirm('Are you sure you want to delete this question?')) {
        allQuestions[sport].splice(index, 1);
        saveQuestionsToStorage();
        loadAllQuestions();
    }
}

function cancelEdit() {
    document.getElementById('question-form-container').style.display = 'none';
    currentEditingId = null;
}

function refreshQuestions() {
    loadAllQuestions();
}

// ==================== ADMIN AUTHENTICATION ====================
function adminSignIn() {
    const adminPassword = document.getElementById('admin-password').value.trim();
    if (!adminPassword) {
        showError('admin-error', 'Please enter admin password');
        return;
    }
    if (adminPassword === ADMIN_CONFIG.password) {
        closeModal('adminSigninModal');
        document.getElementById('auth-btns').style.display = 'none';
        document.getElementById('admin-display').style.display = 'flex';
        localStorage.setItem('sportyq_admin_session', 'true');
        openAdminPanel();
    } else {
        showError('admin-error', 'Invalid admin password');
    }
}

function openAdminPanel() {
    console.log("Opening admin panel");
    switchSection('admin-panel');
    loadAllQuestions();
}

function checkAdminSession() {
    const isAdmin = localStorage.getItem('sportyq_admin_session');
    if (isAdmin === 'true') {
        document.getElementById('auth-btns').style.display = 'none';
        document.getElementById('admin-display').style.display = 'flex';
    }
}

// ==================== USER AUTHENTICATION ====================
function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

function validatePassword(password) {
    return password.length >= 6;
}

function showError(elementId, message) {
    const element = document.getElementById(elementId);
    element.textContent = message;
    element.style.display = 'block';
    setTimeout(() => { element.style.display = 'none'; }, 5000);
}

function showSuccess(elementId, message) {
    const element = document.getElementById(elementId);
    element.textContent = message;
    element.style.display = 'block';
    setTimeout(() => { element.style.display = 'none'; }, 5000);
}

function clearFormErrors() {
    document.getElementById('signin-error').style.display = 'none';
    document.getElementById('signup-error').style.display = 'none';
    document.getElementById('signup-success').style.display = 'none';
    document.getElementById('admin-error').style.display = 'none';
}

function signIn() {
    clearFormErrors();
    const email = document.getElementById('signin-email').value.trim();
    const password = document.getElementById('signin-password').value;
    if (!email || !password) {
        showError('signin-error', 'Please fill in all fields');
        return;
    }
    if (!validateEmail(email)) {
        showError('signin-error', 'Please enter a valid email address');
        return;
    }
    if (!userDatabase[email]) {
        showError('signin-error', 'No account found with this email');
        return;
    }
    if (userDatabase[email].password !== password) {
        showError('signin-error', 'Incorrect password');
        return;
    }
    const name = userDatabase[email].name;
    document.getElementById('username-span').innerText = name;
    closeModal('signinModal');
    document.getElementById('auth-btns').style.display = 'none';
    document.getElementById('user-display').style.display = 'flex';
    switchSection('sports-selection');
    localStorage.setItem('sportyq_current_user', JSON.stringify({ email: email, name: name }));
}

function signUp() {
    clearFormErrors();
    const name = document.getElementById('signup-name').value.trim();
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value;
    if (!name || !email || !password) {
        showError('signup-error', 'Please fill in all fields');
        return;
    }
    if (!validateEmail(email)) {
        showError('signup-error', 'Please enter a valid email address');
        return;
    }
    if (!validatePassword(password)) {
        showError('signup-error', 'Password must be at least 6 characters long');
        return;
    }
    if (userDatabase[email]) {
        showError('signup-error', 'An account with this email already exists');
        return;
    }
    userDatabase[email] = { name: name, password: password };
    localStorage.setItem('sportyq_users', JSON.stringify(userDatabase));
    showSuccess('signup-success', 'Account created successfully! You can now sign in.');
    document.getElementById('signup-name').value = '';
    document.getElementById('signup-email').value = '';
    document.getElementById('signup-password').value = '';
    setTimeout(() => {
        closeModal('signupModal');
        openModal('signinModal');
    }, 2000);
}

function logout() {
    localStorage.removeItem('sportyq_current_user');
    localStorage.removeItem('sportyq_admin_session');
    location.reload();
}

function checkLoggedInUser() {
    const currentUser = JSON.parse(localStorage.getItem('sportyq_current_user'));
    if (currentUser) {
        document.getElementById('username-span').innerText = currentUser.name;
        document.getElementById('auth-btns').style.display = 'none';
        document.getElementById('user-display').style.display = 'flex';
    }
    checkAdminSession();
}

// ==================== MODAL MANAGEMENT ====================
document.querySelector('.signin-btn').addEventListener('click', ()=> openModal('signinModal'));
document.querySelector('.signup-btn').addEventListener('click', ()=> openModal('signupModal'));
document.querySelector('.admin-signin-btn').addEventListener('click', ()=> openModal('adminSigninModal'));

function openModal(id){ 
    clearFormErrors();
    document.getElementById(id).classList.add('active'); 
}
function closeModal(id){ document.getElementById(id).classList.remove('active'); }
function openSignupFromSignin() { closeModal('signinModal'); openModal('signupModal'); }
function openSigninFromSignup() { closeModal('signupModal'); openModal('signinModal'); }

// ==================== NAVIGATION ====================
let currentSport = "";
let currentMode = "";
let score = 0;
let currentQuestionData = null;
let slideIndex = 0;
const slides = document.querySelectorAll('.slide');
const sections = document.querySelectorAll('.section');

function switchSection(className) {
    sections.forEach(sec => sec.classList.remove('active'));
    document.querySelector(`.${className}`).classList.add('active');
}

function chooseQuestionType(sport){
    currentSport = sport;
    document.getElementById('sportName').innerText = `Mission: ${sport}`;
    openModal('questionTypeModal');
}

// ==================== QUIZ GAME LOGIC ====================
function startQuiz(mode) {
    currentMode = mode;
    closeModal('questionTypeModal');
    switchSection('quiz-section');
    document.getElementById('quiz-sport-label').innerText = currentSport + (mode === 'AI' ? " (AI Mode)" : "");
    score = 0;
    updateScore();
    if (currentMode === 'AI') {
        initAiDeck(currentSport);
    } else {
        initClassicDeck(currentSport);
    }
    loadQuestion();
}

function loadQuestion() {
    document.getElementById('next-btn').style.display = 'none';
    const container = document.getElementById('options-container');
    container.innerHTML = "";
    if (currentMode === 'AI') {
        currentQuestionData = getNextAiQuestion(currentSport);
    } else {
        if (classicDeck.length === 0) {
            initClassicDeck(currentSport);
        }
        let qRaw = classicDeck.pop();
        currentQuestionData = {
            question: qRaw.q,
            correct: qRaw.correct,
            options: shuffleArray([...qRaw.options])
        };
    }
    document.getElementById('question-text').innerText = currentQuestionData.question;
    currentQuestionData.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.innerText = opt;
        btn.dataset.answer = opt;
        btn.onclick = () => handleAnswer(btn, opt);
        container.appendChild(btn);
    });
}

function handleAnswer(btn, selectedValue) {
    const allBtns = document.querySelectorAll('.option-btn');
    allBtns.forEach(b => b.disabled = true);
    if (selectedValue === currentQuestionData.correct) {
        btn.classList.add('correct');
        score += 10;
        updateScore();
        triggerCelebration();
        document.querySelector('.quiz-container').classList.add('pulse-effect');
        setTimeout(() => {
            document.querySelector('.quiz-container').classList.remove('pulse-effect');
        }, 500);
    } else {
        btn.classList.add('wrong');
        allBtns.forEach(b => {
            if (b.dataset.answer === currentQuestionData.correct) b.classList.add('correct');
        });
    }
    document.getElementById('next-btn').style.display = 'inline-block';
}

function nextQuestion() {
    loadQuestion();
}

function updateScore() {
    document.getElementById('score-val').innerText = score;
}

function exitToMenu() {
    switchSection('sports-selection');
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function showSlides() {
    if (slides.length === 0) return;
    slides[slideIndex].classList.remove('active');
    slideIndex++;
    if (slideIndex >= slides.length) slideIndex = 0;
    slides[slideIndex].classList.add('active');
}

// ==================== CELEBRATION EFFECTS ====================
function triggerCelebration() {
    const container = document.getElementById('celebrationContainer');
    container.style.display = 'block';
    container.innerHTML = '';
    const celebrationTypes = ['confetti', 'emoji', 'fireworks', 'scorePopup'];
    const selectedType = celebrationTypes[Math.floor(Math.random() * celebrationTypes.length)];
    switch(selectedType) {
        case 'confetti': createConfetti(); break;
        case 'emoji': createEmojiCelebration(); break;
        case 'fireworks': createFireworks(); break;
        case 'scorePopup': createScorePopup(); break;
    }
    setTimeout(() => { container.style.display = 'none'; }, 3000);
}

function createConfetti() {
    const container = document.getElementById('celebrationContainer');
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
    for (let i = 0; i < 150; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        const animation = confetti.animate([
            { top: '0px', opacity: 1, transform: `rotate(0deg)` },
            { top: '100vh', opacity: 0, transform: `rotate(${Math.random() * 720}deg)` }
        ], { duration: 2000 + Math.random() * 1000, easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)' });
        container.appendChild(confetti);
    }
}

function createEmojiCelebration() {
    const container = document.getElementById('celebrationContainer');
    const emojis = ['üéâ', 'ü•≥', 'üî•', '‚≠ê', 'üèÜ', 'üíØ', 'üëç', 'üöÄ'];
    for (let i = 0; i < 30; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'emoji-celebration';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = Math.random() * 100 + 'vw';
        emoji.style.animationDelay = (Math.random() * 1) + 's';
        container.appendChild(emoji);
    }
}

function createFireworks() {
    const container = document.getElementById('celebrationContainer');
    for (let i = 0; i < 15; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = Math.random() * 80 + 10 + 'vw';
        firework.style.top = Math.random() * 80 + 10 + 'vh';
        firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        const explosion = firework.animate([
            { width: '5px', height: '5px', opacity: 1, boxShadow: '0 0 10px #fff' },
            { width: '100px', height: '100px', opacity: 0, boxShadow: '0 0 50px #fff' }
        ], { duration: 1000, easing: 'ease-out' });
        container.appendChild(firework);
    }
}

function createScorePopup() {
    const container = document.getElementById('celebrationContainer');
    const popup = document.createElement('div');
    popup.className = 'score-popup';
    popup.textContent = '+10 Points!';
    popup.style.left = '50%';
    popup.style.top = '50%';
    popup.style.transform = 'translate(-50%, -50%)';
    container.appendChild(popup);
}

// ==================== AI QUESTION GENERATION ====================
const sportsOntology = {
    Football: {
        entities: [
            { name: "Lionel Messi", team: "Inter Miami", country: "Argentina", position: "Forward", league: "MLS" },
            { name: "Cristiano Ronaldo", team: "Al Nassr", country: "Portugal", position: "Forward", league: "Saudi Pro League" }
        ],
        relations: ["team", "country", "league", "position"]
    },
    Cricket: {
        entities: [
            { name: "Virat Kohli", team: "India", role: "Batsman", ipl_team: "RCB" },
            { name: "Pat Cummins", team: "Australia", role: "Bowler", ipl_team: "SRH" }
        ],
        relations: ["team", "role", "ipl_team"]
    },
    NBA: {
        entities: [
            { name: "LeBron James", team: "Lakers", position: "Forward", college: "None (High School)" },
            { name: "Steph Curry", team: "Warriors", position: "Guard", college: "Davidson" }
        ],
        relations: ["team", "position", "college"]
    },
    Tennis: {
        entities: [
            { name: "Novak Djokovic", country: "Serbia", hand: "Right-handed", best_surface: "Hard Court" },
            { name: "Carlos Alcaraz", country: "Spain", hand: "Right-handed", best_surface: "Clay/Grass" }
        ],
        relations: ["country", "hand", "best_surface"]
    }
};

let aiDeck = [];
let classicDeck = [];

function initAiDeck(sport) {
    aiDeck = [];
    const domain = sportsOntology[sport];
    if (!domain) return;
    domain.entities.forEach(entity => {
        domain.relations.forEach(relation => {
            aiDeck.push({ entity, relation });
        });
    });
    shuffleArray(aiDeck);
}

function initClassicDeck(sport) {
    classicDeck = [...allQuestions[sport]];
    shuffleArray(classicDeck);
}

function getNextAiQuestion(sport) {
    if (aiDeck.length === 0) initAiDeck(sport);
    const { entity, relation } = aiDeck.pop();
    const answer = entity[relation];
    const potentialDistractors = new Set();
    const domain = sportsOntology[sport];
    domain.entities.forEach(e => {
        if (e[relation] !== answer) potentialDistractors.add(e[relation]);
    });
    if (potentialDistractors.size < 3) {
        if(relation === "country") potentialDistractors.add("Brazil").add("Germany").add("Italy");
        if(relation === "team") potentialDistractors.add("Unknown FC").add("Athletic Club").add("Sporting CP");
        if(relation === "league") potentialDistractors.add("Serie A").add("Ligue 1").add("Eredivisie");
        if(relation === "position") potentialDistractors.add("Goalkeeper").add("Coach").add("Sweeper");
        if(relation === "college") potentialDistractors.add("UCLA").add("North Carolina").add("Michigan");
        if(relation === "best_surface") potentialDistractors.add("Carpet").add("Wood").add("Indoor");
        if(relation === "hand") potentialDistractors.add("Ambidextrous");
    }
    const distractors = Array.from(potentialDistractors).slice(0, 3);
    let questionText = "";
    switch(relation) {
        case "team": questionText = `Which team does ${entity.name} currently play for?`; break;
        case "country": questionText = `Which country does ${entity.name} represent internationally?`; break;
        case "role": questionText = `What is the primary role of ${entity.name} in Cricket?`; break;
        case "league": questionText = `In which league does ${entity.name} currently compete?`; break;
        case "ipl_team": questionText = `Which IPL franchise does ${entity.name} play for?`; break;
        case "position": questionText = `What is ${entity.name}'s primary position on the field/court?`; break;
        case "hand": questionText = `Does ${entity.name} play Left-handed or Right-handed?`; break;
        case "college": questionText = `Which college did ${entity.name} attend before the NBA?`; break;
        case "best_surface": questionText = `On which surface is ${entity.name} considered most dominant?`; break;
        default: questionText = `What is the ${relation} of ${entity.name}?`;
    }
    return {
        type: "AI_GENERATED",
        question: questionText,
        correct: answer,
        options: shuffleArray([answer, ...distractors]),
        logicTrace: `Fact: (${entity.name}, ${relation}, ${answer}) | Remaining in Deck: ${aiDeck.length}`
    };
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM loaded, initializing application...");
    initializeQuestions();
    checkLoggedInUser();
    if (slides.length > 0) setInterval(showSlides, 3000);
});
</script>
</body>
</html>